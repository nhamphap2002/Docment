<?php header("Cache-Control: no-cache, must-revalidate"); header("Expires: Mon, 26 Jul 1997 05:00:00 GMT"); include_once(dirname(__FILE__).'/../../config/config.inc.php');include_once(dirname(__FILE__).'/../../classes/db/Db.php');function traduct($string, $lang = 2) {	global $_MODULES, $_MODULE, $cookie;		$id_lang = $lang;	$file = _PS_MODULE_DIR_.'menuimpact/'.Language::getIsoById($id_lang).'.php';	if (file_exists($file) AND include_once($file))		$_MODULES = !empty($_MODULES) ? array_merge($_MODULES, $_MODULE) : $_MODULE;	if (!is_array($_MODULES))		return (str_replace('"', '&quot;', $string));    $specific = "";	$source  = strtolower($specific);	$string2 = str_replace('\'', '\\\'', $string);	$currentKey = '<{menuimpact}'._THEME_NAME_.'>menuimpact'.$source.'_'.md5($string2);	$defaultKey = '<{menuimpact}prestashop>menuimpact'.$source.'_'.md5($string2);	if (key_exists($currentKey, $_MODULES))		$ret = stripslashes($_MODULES[$currentKey]);	elseif (key_exists($defaultKey, $_MODULES))		$ret = stripslashes($_MODULES[$defaultKey]);	else		$ret = $string;	return str_replace('"', '&quot;', $ret);}function displayFlagsMD($languages, $defaultLanguage, $ids, $id, $return = false){		if (sizeof($languages) == 1)			return false;		$defaultIso = Language::getIsoById($defaultLanguage);		$htmlOut = '		<div class="display_flags" style="float: left">			<img src="../img/l/'.$defaultLanguage.'.jpg" class="pointer" id="language_current_'.$id.'" onclick="showLanguagesMD(\''.$id.'\');" alt="" />		</div>		<div id="languages_'.$id.'" class="language_flags">';		foreach ($languages as $language)			$htmlOut .= '<img src="../img/l/'.intval($language['id_lang']).'.jpg" class="pointer" alt="'.$language['name'].'" title="'.$language['name'].'" onclick="changeLanguageMD(\''.$id.'\', \''.$ids.'\', '.$language['id_lang'].', \''.$language['iso_code'].'\');" /> ';		$htmlOut .= '</div>';		if ($return)			return $htmlOut;		echo $htmlOut;}if(isset($_GET['action'])) {	switch($_GET['action']) {			case "CustomMenuAdd":			$defaultLanguage = intval(Configuration::get('PS_LANG_DEFAULT'));			$languages = Language::getLanguages();			$iso = Language::getIsoById($defaultLanguage);			Db::getInstance()->Execute('INSERT INTO '._DB_PREFIX_.'menimp_tunpip_menu  				  (id_onglet, pla_col, pla_lin) VALUES 				  ('.$_GET['idOnglet'].', 10, 10)				  ');				$IdCustom = Db::getInstance()->Insert_ID();			foreach ($languages as $language) {				Db::getInstance()->Execute('INSERT INTO '._DB_PREFIX_.'menimp_tunpip_menu_lang  					  (id_onglet, id_tunpip, id_lang, name_menu) VALUES 					  ('.$_GET['idOnglet'].', '.$IdCustom.', '.$language['id_lang'].', "'.$_GET['MenuName_'.$language['id_lang']].'")					  ');				}		break;		case "CustomMenuDelete":			Db::getInstance()->Execute('DELETE FROM '._DB_PREFIX_.'menimp_tunpip_menu  				  WHERE id_onglet = '.$_GET['idOnglet'].' 				  AND (id_parent = '.$_GET['idCustomMenu'].' 				  OR id_tunpip = '.$_GET['idCustomMenu'].')				  ');			break;		case "CustomMenuSave":			$defaultLanguage = intval(Configuration::get('PS_LANG_DEFAULT'));			$languages = Language::getLanguages();			$iso = Language::getIsoById($defaultLanguage);			Db::getInstance()->Execute('UPDATE '._DB_PREFIX_.'menimp_tunpip_menu SET 				  pla_col='.$_GET['columnMenu'].', 				  pla_lin='.$_GET['lineMenu'].', link="'.addslashes($_GET['linkMenu']).'" 				  WHERE id_onglet = '.$_GET['idOnglet'].' AND id_tunpip = '.$_GET['idCustomMenu'].' 				  ');				Db::getInstance()->Execute('DELETE FROM '._DB_PREFIX_.'menimp_tunpip_menu_lang 									   WHERE id_onglet = '.$_GET['idOnglet'].' AND id_tunpip = '.$_GET['idCustomMenu']);			foreach ($languages as $language) {				Db::getInstance()->Execute('INSERT INTO '._DB_PREFIX_.'menimp_tunpip_menu_lang 					  (id_onglet, id_tunpip, id_lang, name_menu) VALUES 					  ('.$_GET['idOnglet'].', '.$_GET['idCustomMenu'].', 					   '.$language['id_lang'].', "'.addslashes($_GET['nameMenu_'.$language['id_lang']]).'")');				}		break;		case "CustomSubMenuAdd":			$defaultLanguage = intval(Configuration::get('PS_LANG_DEFAULT'));			$languages = Language::getLanguages();			$iso = Language::getIsoById($defaultLanguage);			Db::getInstance()->Execute('INSERT INTO '._DB_PREFIX_.'menimp_tunpip_menu  				  (id_onglet, id_parent, name_menu, pla_col, pla_lin) VALUES 				  ('.$_GET['idOnglet'].', '.$_GET['idCustomMenu'].', "'.$_GET['SubMenuName'].'", 10, 10)				  ');				$IdCustom = Db::getInstance()->Insert_ID();			foreach ($languages as $language) {				Db::getInstance()->Execute('INSERT INTO '._DB_PREFIX_.'menimp_tunpip_menu_lang  					  (id_onglet, id_tunpip, id_lang, name_menu) VALUES 					  ('.$_GET['idOnglet'].', '.$IdCustom.', '.$language['id_lang'].', "'.$_GET['SubMenuName_'.$language['id_lang']].'")					  ');				}		break;				case "DetailMenu":			$defaultLanguage = intval(Configuration::get('PS_LANG_DEFAULT'));			$languages = Language::getLanguages();			$iso = Language::getIsoById($defaultLanguage);			$htmlGen = '';			$MenuDetail = Db::s('SELECT * FROM '._DB_PREFIX_.'menimp_tunpip_menu 						    	WHERE id_onglet='.$_GET['idOnglet'].' AND id_parent=0  								ORDER BY pla_col, pla_lin');			if(sizeof($MenuDetail)) {				$htmlGen .= '<table cellpadding="2" cellspacing="0" border="0" class="table" width="100%">';								foreach($MenuDetail as $KMd=>$ContMd) {					$htmlGen .= '<TR class="expandable">';					$htmlGen .= '<TD class="idzer" align="center">'.$ContMd['id_tunpip'].'</TD>';					$htmlGen .= '<TD>';					$htmlGen .= '<table style="font-size:10px" width="100%">					<TR><TD class="pos5">					'.traduct('Name', $_GET['idLang']).'&nbsp;:&nbsp;</TD>					<TD class="pos6">&nbsp;';					foreach ($languages as $language) {						$LangMenu = Db::s('SELECT * FROM '._DB_PREFIX_.'menimp_tunpip_menu_lang  						WHERE id_onglet='.$ContMd['id_onglet'].' 						AND id_tunpip='.$ContMd['id_tunpip'].' 						AND id_lang='.$language['id_lang']);						$htmlGen .= '<div id="DivMenuLang'.$ContMd['id_tunpip'].'_'.$language['id_lang'].'" style="display: '.($language['id_lang'] == $defaultLanguage ? 'block' : 'none').'; float: left" class="divLang">';						$htmlGen .= '<input type="text" id="MenuName_'.$ContMd['id_onglet'].'_'.$ContMd['id_tunpip'].'_'.$language['id_lang'].'" name="MenuName_'.$ContMd['id_onglet'].'_'.$ContMd['id_tunpip'].'_'.$language['id_lang'].'" style="font-size : 10px; width: 180px" value="'.$LangMenu[0]['name_menu'].'"></div>';					}					$htmlGen .= displayFlagsMD($languages, $defaultLanguage, 'DivMenuLang'.$ContMd['id_tunpip'], 'DivMenuLang'.$ContMd['id_tunpip'], true);					$htmlGen .= '</TD>';$htmlGen .= '<TD class="pos7" align="left"><select id="column_'.$ContMd['id_onglet'].'_'.$ContMd['id_tunpip'].'" style="font-size : 10px"><option value="1" '.($ContMd['pla_col'] == 1 ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Column', $_GET['idLang']).' 1&nbsp;&nbsp;</option><option value="2" '.($ContMd['pla_col'] == 2 ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Column', $_GET['idLang']).' 2&nbsp;&nbsp;</option><option value="3" '.($ContMd['pla_col'] == 3 ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Column', $_GET['idLang']).' 3&nbsp;&nbsp;</option><option value="4" '.($ContMd['pla_col'] == 4 ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Column', $_GET['idLang']).' 4&nbsp;&nbsp;</option></select>&nbsp;<select id="line_'.$ContMd['id_onglet'].'_'.$ContMd['id_tunpip'].'" style="font-size : 10px"><option value="1"  '.($ContMd['pla_lin'] == 1  ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Line', $_GET['idLang']).' 1&nbsp;&nbsp;</option><option value="2"  '.($ContMd['pla_lin'] == 2  ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Line', $_GET['idLang']).' 2&nbsp;&nbsp;</option><option value="3"  '.($ContMd['pla_lin'] == 3  ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Line', $_GET['idLang']).' 3&nbsp;&nbsp;</option><option value="4"  '.($ContMd['pla_lin'] == 4  ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Line', $_GET['idLang']).' 4&nbsp;&nbsp;</option><option value="5"  '.($ContMd['pla_lin'] == 5  ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Line', $_GET['idLang']).' 5&nbsp;&nbsp;</option><option value="6"  '.($ContMd['pla_lin'] == 6  ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Line', $_GET['idLang']).' 6&nbsp;&nbsp;</option><option value="7"  '.($ContMd['pla_lin'] == 7  ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Line', $_GET['idLang']).' 7&nbsp;&nbsp;</option><option value="8"  '.($ContMd['pla_lin'] == 8  ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Line', $_GET['idLang']).' 8&nbsp;&nbsp;</option></select></TD></TR>';					$htmlGen .= '</TABLE><table style="font-size:10px" width="100%">';					$htmlGen .= '<TR style="float: left; width:400px;"><TD  class="pos5" >'.traduct('Link', $_GET['idLang']).'&nbsp;:&nbsp;</TD><TD  class="pos6">&nbsp;<input type="text" id="MenuLink_'.$ContMd['id_onglet'].'_'.$ContMd['id_tunpip'].'" name"MenuLink_'.$ContMd['id_onglet'].'_'.$ContMd['id_tunpip'].'" style="font-size : 10px; width: 200px" value="'.$ContMd['link'].'"></TD></TR>';					$htmlGen .= '<TR style="float: left; width:400px;"><TD class="pos5">'.traduct('Sub-menu', $_GET['idLang']).'&nbsp;:&nbsp;</TD><TD>&nbsp;';					foreach ($languages as $language) {						$htmlGen .= '<div id="CustomSubName'.$ContMd['id_tunpip'].'_'.$language['id_lang'].'" style="display: '.($language['id_lang'] == $defaultLanguage ? 'block' : 'none').'; float: left" class="divLang">';						$htmlGen .= '<input type="text" id="CustomSubMenuName_'.$ContMd['id_tunpip'].'_'.$language['id_lang'].'" width="200" style="font-size : 10px"></div>';					}					$htmlGen .= displayFlagsMD($languages, $defaultLanguage, 'CustomSubName'.$ContMd['id_tunpip'], 'CustomSubName'.$ContMd['id_tunpip'], true);					$htmlGen .= '&nbsp;<input type="button" value="'.traduct('Add', $_GET['idLang']).'" onClick=\'addCustomSubMenu("'.$ContMd['id_onglet'].'","'.$ContMd['id_tunpip'].'" )\' class="button" style="font-size : 10px"></TD></TR></TABLE>';					$htmlGen .= '<div id="tunpipSubMenu_'.$ContMd['id_tunpip'].'" width="100%">';					$SubMenuDetail = Db::s('SELECT * FROM '._DB_PREFIX_.'menimp_tunpip_menu 					WHERE id_onglet='.$ContMd['id_onglet'].' AND id_parent='.$ContMd['id_tunpip'].'  					ORDER BY pla_col, pla_lin');					if(sizeof($SubMenuDetail)) {						$htmlGen .= '<table  cellpadding="2" cellspacing="0" border="0" class="table" width="100%"style="font-size:10px">';						foreach($SubMenuDetail as $KSMd=>$ContSMd) {							$htmlGen .= '<div ><TR>';							$htmlGen .= '<TD class="idzer2" align="center" rowspan="2">'.$ContSMd['id_tunpip'].'</TD>';							$htmlGen .= '<TD class="pos5">'.traduct('Name', $_GET['idLang']).'&nbsp;:&nbsp;</TD><TD>';							foreach ($languages as $language) {								$LangMenu = Db::s('SELECT * FROM '._DB_PREFIX_.'menimp_tunpip_menu_lang  								WHERE id_onglet='.$ContSMd['id_onglet'].' 								AND id_tunpip='.$ContSMd['id_tunpip'].' 								AND id_lang='.$language['id_lang']);								$htmlGen .= '<div id="DivMenuLang'.$ContSMd['id_tunpip'].'_'.$language['id_lang'].'" style="display: '.($language['id_lang'] == $defaultLanguage ? 'block' : 'none').'; float: left" class="divLang">';								$htmlGen .= '<input type="text" id="MenuName_'.$ContSMd['id_onglet'].'_'.$ContSMd['id_tunpip'].'_'.$language['id_lang'].'" name="MenuName_'.$ContSMd['id_onglet'].'_'.$ContSMd['id_tunpip'].'_'.$language['id_lang'].'" style="font-size : 10px; width: 180px" value="'.$LangMenu[0]['name_menu'].'"></div>';							}			$htmlGen .= displayFlagsMD($languages, $defaultLanguage, 'DivMenuLang'.$ContSMd['id_tunpip'], 'DivMenuLang'.$ContSMd['id_tunpip'], true);			$htmlGen .= '&nbsp;<input type="hidden" id="column_'.$ContSMd['id_onglet'].'_'.$ContSMd['id_tunpip'].'" value="0">';			$htmlGen .= '&nbsp;<select id="line_'.$ContSMd['id_onglet'].'_'.$ContSMd['id_tunpip'].'" style="font-size : 10px">				<option value="1"  '.($ContSMd['pla_lin'] == 1  ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Line', $_GET['idLang']).' 1&nbsp;&nbsp;</option>				<option value="2"  '.($ContSMd['pla_lin'] == 2  ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Line', $_GET['idLang']).' 2&nbsp;&nbsp;</option>				<option value="3"  '.($ContSMd['pla_lin'] == 3  ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Line', $_GET['idLang']).' 3&nbsp;&nbsp;</option>				<option value="4"  '.($ContSMd['pla_lin'] == 4  ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Line', $_GET['idLang']).' 4&nbsp;&nbsp;</option>				<option value="5"  '.($ContSMd['pla_lin'] == 5  ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Line', $_GET['idLang']).' 5&nbsp;&nbsp;</option>				<option value="6"  '.($ContSMd['pla_lin'] == 6  ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Line', $_GET['idLang']).' 6&nbsp;&nbsp;</option>				<option value="7"  '.($ContSMd['pla_lin'] == 7  ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Line', $_GET['idLang']).' 7&nbsp;&nbsp;</option>				<option value="8"  '.($ContSMd['pla_lin'] == 8  ? " selected" : false).'>&nbsp;&nbsp;'.traduct('Line', $_GET['idLang']).' 8&nbsp;&nbsp;</option>											</select></TD>';							$htmlGen .= '<TD rowspan="2" align="center">';							$htmlGen .= '<img src="../img/admin/cross.png" style="cursor: pointer" onClick=\'deleteCustomMenu("'.$ContSMd['id_onglet'].'", "'.$ContSMd['id_tunpip'].'")\'/>										  <img src="../modules/menuimpact/img/save.png" style="cursor: pointer" onClick=\'saveCustomMenu("'.$ContSMd['id_onglet'].'", "'.$ContSMd['id_tunpip'].'")\'/>';							$htmlGen .= '</TD></TR>';							$htmlGen .= '<TR class="expandable2"><TD class="pos5">Lien&nbsp;:&nbsp;</TD><TD><input type="text" id="MenuLink_'.$ContSMd['id_onglet'].'_'.$ContSMd['id_tunpip'].'" name"MenuLink_'.$ContSMd['id_onglet'].'_'.$ContSMd['id_tunpip'].'" style="font-size : 10px; width: 180px" value="'.$ContSMd['link'].'"></TD>';							$htmlGen .= '</TR>							';						}						$htmlGen .= '</table>';					}					$htmlGen .= '</div>';					$htmlGen .= '</TD>';					$htmlGen .= '<TD valign="top" style="width:210px; text-align:center;padding-top: 5px; background-color:#e9e9e9;">';					$htmlGen .= '<img src="../img/admin/cross.png" style="cursor: pointer" onClick=\'deleteCustomMenu("'.$ContMd['id_onglet'].'", "'.$ContMd['id_tunpip'].'")\'/>								  <img src="../modules/menuimpact/img/save.png" style="cursor: pointer" onClick=\'saveCustomMenu("'.$ContMd['id_onglet'].'", "'.$ContMd['id_tunpip'].'")\'/>';					$htmlGen .= '</TD></TR></div>';				}				$htmlGen .= "</div></table>";			}			echo $htmlGen;		break;	}}?>